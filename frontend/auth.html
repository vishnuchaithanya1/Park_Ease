<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Park Ease - Login & Register</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
      }
      .fade-in {
        animation: fadeIn 0.3s ease-in-out;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>
  <body class="bg-gray-50 flex items-center justify-center min-h-screen p-4">
    <div
      class="bg-white rounded-2xl shadow-xl w-full max-w-md overflow-hidden fade-in"
    >
      <!-- Header -->
      <div class="bg-indigo-600 p-8 text-center">
        <div
          class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-indigo-500 mb-4 text-white"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-6 w-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"
            />
          </svg>
        </div>
        <h1 class="text-3xl font-bold text-white tracking-tight">Park Ease</h1>
        <p class="text-indigo-200 mt-2 text-sm">
          Smart Parking Management System
        </p>
      </div>

      <!-- Navigation Tabs -->
      <div class="flex border-b border-gray-100">
        <button
          onclick="switchTab('login')"
          id="tab-login"
          class="flex-1 py-4 text-sm font-medium text-indigo-600 border-b-2 border-indigo-600 focus:outline-none transition-colors"
        >
          Login
        </button>
        <button
          onclick="switchTab('register')"
          id="tab-register"
          class="flex-1 py-4 text-sm font-medium text-gray-500 hover:text-gray-700 focus:outline-none transition-colors"
        >
          Register
        </button>
      </div>

      <!-- Forms Container -->
      <div class="p-8">
        <!-- Alert Box (Hidden by default) -->
        <div
          id="alert-box"
          class="hidden mb-4 p-3 rounded text-sm text-center"
        ></div>

        <!-- Login Form -->
        <form id="login-form" onsubmit="handleLogin(event)" class="space-y-5">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Email or Phone</label
            >
            <input
              type="text"
              id="login-identifier"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition"
              placeholder="user@example.com"
              required
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Password</label
            >
            <input
              type="password"
              id="login-password"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition"
              placeholder="••••••••"
              required
            />
          </div>

          <div class="flex items-center justify-between text-sm">
            <label class="flex items-center text-gray-600">
              <input
                type="checkbox"
                class="mr-2 rounded text-indigo-600 focus:ring-indigo-500"
              />
              Remember me
            </label>
            <a
              href="#"
              class="text-indigo-600 hover:text-indigo-500 font-medium"
              >Forgot Password?</a
            >
          </div>

          <button
            type="submit"
            class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-lg shadow-lg transition transform active:scale-95"
          >
            Sign In
          </button>
        </form>

        <!-- Register Form (Hidden by default) -->
        <form
          id="register-form"
          onsubmit="handleRegister(event)"
          class="space-y-4 hidden"
        >
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Full Name</label
            >
            <input
              type="text"
              id="reg-name"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none"
              placeholder="John Doe"
              required
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Email Address</label
            >
            <input
              type="email"
              id="reg-email"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none"
              placeholder="john@example.com"
              required
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Phone Number</label
            >
            <input
              type="tel"
              id="reg-phone"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none"
              placeholder="9876543210"
              required
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Password</label
            >
            <input
              type="password"
              id="reg-password"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none"
              placeholder="Create a password"
              required
            />
          </div>

          <button
            type="submit"
            class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-lg shadow-lg transition transform active:scale-95 mt-2"
          >
            Create Account
          </button>
        </form>
      </div>

      <!-- Footer -->
      <div class="bg-gray-50 px-8 py-4 border-t border-gray-100 text-center">
        <p class="text-xs text-gray-500">
          &copy; 2025 Park Ease Inc. All rights reserved.
        </p>
      </div>
    </div>

    <!-- JavaScript Logic -->
    <script>
      const API_BASE_URL = "http://localhost:8080/api/auth"; // Adjust if needed

      function switchTab(tab) {
        const loginForm = document.getElementById("login-form");
        const regForm = document.getElementById("register-form");
        const tabLogin = document.getElementById("tab-login");
        const tabReg = document.getElementById("tab-register");
        const alertBox = document.getElementById("alert-box");

        alertBox.classList.add("hidden"); // Clear alerts

        if (tab === "login") {
          loginForm.classList.remove("hidden");
          regForm.classList.add("hidden");

          tabLogin.classList.add(
            "text-indigo-600",
            "border-b-2",
            "border-indigo-600"
          );
          tabLogin.classList.remove("text-gray-500");

          tabReg.classList.remove(
            "text-indigo-600",
            "border-b-2",
            "border-indigo-600"
          );
          tabReg.classList.add("text-gray-500");
        } else {
          loginForm.classList.add("hidden");
          regForm.classList.remove("hidden");

          tabReg.classList.add(
            "text-indigo-600",
            "border-b-2",
            "border-indigo-600"
          );
          tabReg.classList.remove("text-gray-500");

          tabLogin.classList.remove(
            "text-indigo-600",
            "border-b-2",
            "border-indigo-600"
          );
          tabLogin.classList.add("text-gray-500");
        }
      }

      function showAlert(message, type) {
        const alertBox = document.getElementById("alert-box");
        alertBox.classList.remove(
          "hidden",
          "bg-red-100",
          "text-red-700",
          "bg-green-100",
          "text-green-700"
        );

        if (type === "error") {
          alertBox.classList.add("bg-red-100", "text-red-700");
        } else {
          alertBox.classList.add("bg-green-100", "text-green-700");
        }
        alertBox.innerText = message;
      }

      async function handleLogin(event) {
        event.preventDefault();
        const identifier = document.getElementById("login-identifier").value;
        const password = document.getElementById("login-password").value;

        try {
          const response = await fetch(`${API_BASE_URL}/login`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ identifier, password }),
          });

          const data = await response.json();

          if (response.ok) {
            // Success! Save Token
            localStorage.setItem("parkease_token", data.token);
            localStorage.setItem("parkease_user", data.username);
            showAlert("Login Successful! Redirecting...", "success");

            // Redirect to Dashboard after 1 second
            setTimeout(() => {
              window.location.href = "dashboard.html";
            }, 1000);
          } else {
            showAlert(data.message || "Invalid Credentials", "error");
          }
        } catch (error) {
          console.error("Error:", error);
          showAlert("Invalid email or password?", "error");
        }
      }

      async function handleRegister(event) {
        event.preventDefault();
        const name = document.getElementById("reg-name").value;
        const email = document.getElementById("reg-email").value;
        const phone = document.getElementById("reg-phone").value;
        const password = document.getElementById("reg-password").value;

        try {
          const response = await fetch(`${API_BASE_URL}/register`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name, email, phone, password }),
          });

          // Check if response is text or json
          const text = await response.text();
          let data;
          try {
            data = JSON.parse(text);
          } catch {
            data = { message: text }; // Handle plain text response
          }

          if (response.ok) {
            showAlert("Registration Successful! Please Login.", "success");
            // Clear form and switch to login tab
            document.getElementById("register-form").reset();
            setTimeout(() => switchTab("login"), 1500);
          } else {
            showAlert(
              data.message || data.error || "Registration Failed",
              "error"
            );
          }
        } catch (error) {
          console.error("Error :", error);
          showAlert("Server connection failed.", "error");
        }
      }
    </script>
  </body>
</html>
